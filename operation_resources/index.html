<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://webmev.tm4.org/operation_resources/">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Operation-associated resources - WebMeV REST API</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  <link href="../style.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Operation-associated resources";
    var mkdocs_page_input_path = "operation_resources.md";
    var mkdocs_page_url = "/operation_resources/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> WebMeV REST API</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../general_architecture/">Architecture</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Installation and Setup</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../install/">Preliminaries</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mev_cluster_setup/">Installation and setup</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../setup_configuration/">Configuration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../management_commands/">Management commands</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../data_server/">Mock data server</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../api/">Intro and core concepts</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="#">Data Structures</a>
    <ul class="current">
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Resources</a>
    <ul class="current">
                <li class="toctree-l3"><a class="reference internal" href="../resources/">General info</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../resource_types/">Resource types</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../resource_metadata/">Resource metadata</a>
                </li>
                <li class="toctree-l3 current"><a class="reference internal current" href="./">Operation-associated resources</a>
    <ul class="current">
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../attributes/">Attributes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../elements/">Observations and Features</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../observation_and_feature_sets/">ObservationSet and FeatureSets</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../workspaces/">Workspaces</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../metadata/">Workspace metadata</a>
                </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../auth/">Authentication</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../operations/">Operation concepts</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../creating_analyses/">Creating new analyses/operations</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../example_workflow/">Workflow and analysis concepts</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../public_data/">Creating and managing public data</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">WebMeV REST API</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Resources &raquo;</li>
        
      
        
          <li>Data Structures &raquo;</li>
        
      
        
          <li>API &raquo;</li>
        
      
    
    <li>Operation-associated resources</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/web-mev/mev-backend/edit/master/docs/operation_resources.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h3 id="operation-resources"><a class="toclink" href="#operation-resources">Operation resources</a></h3>
<p>For certain <code>Operation</code>s, we require data such as gene lists, gene-alias lookups, genome indices, and similar files which are not provided or owned by WebMEV users. Instead, these special <code>Resource</code>s are associated with the <code>Operation</code> they are used with. Suggestively, we call these <code>OperationResource</code> instances. Depending on the run-mode of the <code>Operation</code>, these <code>OperationResource</code>s are handled in different ways.</p>
<p>Regardless of the run-mode of the <code>Operation</code> (i.e. local, remote), we can handle these operation-specific resources in two ways. One method relies on the image container to hold the file. The other method requires WebMEV to "register" the <code>OperationResource</code> just as it does with user-associated <code>Resource</code>s .</p>
<p>The first method to distribute these user-independent files is to simply build them directly into the container. For small files, this solution is straightforward and does not require any special handling by WebMEV itself. For reproducing analyses, the versioned container image can always be pulled and run, ensuring the same files are used. Note that this assumes the files are "static" within that container and not dynamically queried/generated when the container is executed for an analysis operation. For instance, if the gene annotations, etc. are queried from BioMart on-the-fly <em>during</em> an analysis execution, then we can't necessarily guarantee 100% fidelity as the underlying data may change. On the other hand, if the files are created upon building/pushing the image, then those files can be safely distributed with the image and will remain unchanged within that image. </p>
<p>Instead of building the files directly into the container image, one may also choose to create the files up front and then have WebMEV "register" them when the <code>Operation</code> is ingested. We do this by including an addition file (<code>operation_resources.json</code>) with the repository. This file gives the "name" of the file, its resource type (e.g. integer matrix, BED file, etc.), and the path to the file. For example, if we have an alignment process that depends on a pre-computed index, our <code>operation_spec.json</code> definition file would have an <code>OperationResource</code> input as follows:</p>
<pre class="codehilite"><code>{
    &quot;name&quot;: &quot;BWA alignment&quot;,
    ...
    &quot;inputs&quot;: {
        ...
        &quot;genome_index&quot;: {
            &quot;description&quot;: &quot;The genome to align to.&quot;, 
            &quot;name&quot;: &quot;Genome choice:&quot;, 
            &quot;required&quot;: true, 
            &quot;spec&quot;: {
                &quot;attribute_type&quot;: &quot;OperationResource&quot;,
                &quot;resource_type&quot;: &quot;*&quot; 
            }
        }
        ...
    }
    ...
}
</code></pre>

<p>(the <code>resource_type</code> wildcard means "any" file type, which is fine for our purposes here). Then, in the same repository, we would have an <code>operation_resources.json</code> that looks like:</p>
<pre class="codehilite"><code>{
    &quot;genome_index&quot;: [
        {
            &quot;name&quot;: &quot;Human&quot;,
            &quot;resource_type&quot;: &quot;*&quot;,
            &quot;path&quot;: &quot;gs://my-bucket/human_index.tar&quot;
        },
        {
            &quot;name&quot;: &quot;Mouse&quot;,
            &quot;resource_type&quot;: &quot;*&quot;,
            &quot;path&quot;: &quot;gs://my-bucket/mouse_index.tar&quot;
        }
    ]
}
</code></pre>

<p>Upon ingestion of this <code>Operation</code>, WebMEV will check for the presence of those files and, if present, will create database objects for these files. When the user wishes to run this <code>Operation</code>, those resources will be presented as the available options for that <code>genome_index</code> input. In accordance with our goal of reproducible research, the ingestion process copies the files to an operation-specific directory. Thus, given the <code>Operation</code>'s UUID, we will copy the file(s) to a storage location identified by that UUID. This way, we can prevent that original path from being overwritten or deleted over time.</p>
<p>Note that the path provided may either be "local" (e.g. <code>"path": "some_file.tsv"</code>) or remote (e.g. <code>"path": "gs://my-bucket/human_index.tar</code>). In the former case (where the path is relative or does not specify a "special" prefix like "gs://") WebMEV expects the file to be among the cloned repository files. Otherwise, we confirm the existence of the file using the appropriate libraries capable of interfacing with the remote storage systems. If the files are not found, then the ingestion of the <code>Operation</code> fails. </p>
<p>The "repository-tracked" files are limited to relatively small files, however. Larger files, such as genome indexes which can be many GB, must be done using the remote storage option, which does require a bit more care to ensure everything is in-sync prior to ingestion. After ingestion, everything is properly versioned by reference to the <code>Operation</code>s UUID. </p>
<p>As a final note, in the spirit of reproducible analyses, we advise that all scripts, etc. used to create the resource files are included in the repository or are otherwise adequately described. This is not something that can be enforced by WebMEV, but we aim to adhere with this guideline.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../attributes/" class="btn btn-neutral float-right" title="Attributes">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../resource_metadata/" class="btn btn-neutral" title="Resource metadata"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/web-mev/mev-backend/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../resource_metadata/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../attributes/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
